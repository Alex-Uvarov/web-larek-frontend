# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных, используемые в приложении

Товар

```

interface IProduct {
    id: string; // id товара
    description: string; // Краткое описание
    image: string; // Изображение
    title: string; // Наименование
    category: string; // Категория
    price: number | null; // Стоимость
}

```

Каталог товаров

```

interface IProductsCatalog {
    setProducts(products: IProduct[]): void; // Добаить товары
    getProducts(): IProduct[]; // Получить список товаров
    getOneProduct(id: string): IProduct; // Получить один товар по id
    setPreview(id: string): void; // Установить id товара, на который кликнули
    getPreview(): string | null; // Получить id товара, на который кликнули
}

```

Данные пользователя

```
interface IOrderForm {
    payment: string; // Способ оплаты
    email: string; // Электронная почта
    phone: string; // Номер телефона
    address: string; // Адрес
}

```

Корзина

```

interface IBasket {
    setProducts(products: IProduct[]): void; // Установить товары
    getProducts(): IProduct[]; // Получить список товаров
    getOneProduct(id: string): IProduct; // Получить один товар по его id
    addToBasket(product: IProduct): void; // Добавить товар в корзину
    removeFromBasket(product: IProduct): void; // Удалить товар из корзины
    getCountOfProducts(): number; // Получить общее количество товаров
    getTotalPrice(): number; // Получить общую стоимость товаров
    clearBasket(): void; // Очистить корзину
}

```

Работа с данными пользователя

```

export interface IOderFormsData {
    getUserInfo(field: keyof IOrderForm): void; // Получить информацию о пользователе
	setInputField(field: keyof IOrderForm, value: string): void; // Установить значения отдельных пунктов информации о пользователе
	validation(): void; // Валидация формы ввода данных пользователя
	clearUser(): void; // Очистить хранимые данные пользователя
}

```

Данные, возвращаемые сервером при отправке заказа

```

interface IOrderResult {
    id: string; // id заказа
    total: number; // общая стоимость
}

```

Данные, получаемые с сервера

```

interface IApiResponse {
    total:number; // общее количество
    items:IProduct[]; // список товаров
}

```

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP:

- слой данных, отвечает за хранение и изменение данных

- слой представления, отвечает за отображение данных на странице,

- презентер, отвечает за связь представления и данных.

### Базовый код

#### Класс Api

Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.

Методы:

- get - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер

- post - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется POST запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

  

#### Класс EventEmitter

Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.

Основные методы, реализуемые классом описаны интерфейсом IEvents:

- on - подписка на событие
- emit - инициализация события
- trigger - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие

  

### Слой данных

#### Класс ProductsModel

Класс овечает за работу с товарами и их списком.

В полях класса хранятся следующие данные:

 - protected products: IProduct[]; // массив карточек 
 - protected _preview: string | null; // превью карточки
 - protected events: IEvents; // брокер событий

В классе используются следующие методы:

- setProducts; // устанавливает список товаров
- getProducts; // возвращает список товаров
- getOneProduct; // возвращает товар по его id
- setPreview; // устанавливает превью карточки
- getPreview; // возвращает превью карточки

////////////////////////////////////////////////////

#### Класс BasketModel

Класс отвечает за хранение и логику работы с данными корзины.\

Конструктор класса принимает инстант брокера событий.\

В полях хранятся следующие данные:

- products: IProduct[]; // список товаров в корзине
- events: IEvents; // брокер событий

В классе используются следующие методы:

- setProducts(products: IProduct[]); // устанавливает список товаров в корзине
- getProducts(): IProduct[]; // возвращает список товаров, хранящихся в корзине
- getOneProduct(id: string): IProduct; // возвращает один товар по его id
- addToBasket(product: IProduct); // добавляет товар в корзину
- removeFromBasket(product: IProduct); // удаляет товар из корзины
- getCountOfProducts(); // возвращает количество товаров в корзине
- getTotalPrice(); // возвращает общую стоимость товаров в корзине
- clearBasket(); // полная очистка корзины

/////////////////////////////////////////////////////

#### Класс OrderModel

Класс отвечает за хранение и логику работы с данными пользователя, получаемыми из форм.

Конструктор класса принимает инстант брокера событий.

В классе хранятся следующие данные:

  данные пользователя: 

- order; // объект с данными пользователя
- events; // брокер событий


Класс использует следующие методы:

- saveUsesetInputFieldrData; // сохранение данных пользователя (для каждого поля отдельно)
- getUserInfo; // передача данных пользователя на сервер
- validation; // валидация
- clearUser; // очистка данных пользователя
  

### Классы представления
Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.


#### Класс Modal
Реализует модальное окно.

Реализует методы:

- set content; //Устанавливает содержимое модального окна
- open; //Открывает модальное окно
- close; //Закрытие модального окна;
- render; //Рендеринг модального окна;

Конструктор принимает селектор, по которому в разметке страницы будет идентифицировано модальное окно и экземпляр класса EventEmitter для возможности инициации событий.

Поля класса
- _closeButton: HTMLButtonElement; //кнопка закрытия модального окна
- _content: HTMLElement; //содержимое модального окна
- position: number; //положение на странице по вертикали

#### Класс Page
Реализует главную страницу.
Реализует поля:
 - _wrapper: HTMLElement; // контейнер страницы
 - _basket: HTMLElement; // коризна
 - _counter: HTMLElement; // счетчик
 - _catalog: HTMLElement; // каталог 

Реализует методы:
 - set catalog(products: HTMLElement[]): установка каталога
 - set сounter(value: number); // установка счетчика
 - set locked(value: boolean); // установка блокировки корзины

 Конструктор принимает селектор, по которому в разметке страницы будет идентифицировано модальное окно и экземпляр класса EventEmitter для возможности инициации событий.

#### Класс BaseProductView
Отвечает за установку значений свойств общих для товаров, находящихся в разных частях страницы (в каталоге, корзине и модальном окне)

Реализует поля:
 - _title: HTMLElement; // контейнер наименования товара
 - _price: HTMLElement; // контейнер стоимости товара
 - events: IEvents; // брокер событий
 - _catalog: HTMLElement; // каталог 

Реализует методы:
 - set title(value: string); // установка наименования товара
 - set price(value: number); установка стоимости товара
 - set id(value: string); // установка id товара
 - get id():string; // получение id товара

  Конструктор принимает селектор, по которому в разметке страницы будет идентифицировано модальное окно и экземпляр класса EventEmitter для возможности инициации событий.

#### Класс CatalogProductView
Отвечает за установку значений свойств, необходимых для отображения товара в каталоге

Расширяет класс BaseProductView

Реализует поля:
 - _category: HTMLElement; // контейнер категории товара
 - _image: HTMLImageElement // контейнер изображения товара

Реализует методы:
 - set category(value: string); // установка категории товара
 - set image(src:string); установка изображения товара

  Конструктор принимает селектор, по которому в разметке страницы будет идентифицировано модальное окно и экземпляр класса EventEmitter для возможности инициации событий.

#### Класс PreviewProductView
Отвечает за установку значений свойств, необходимых для отображения товара в модальном окне

Расширяет класс CatalogProductView

Реализует поля:
 - _description: HTMLElement; // краткое описание товара
 - protected _button: HTMLButtonElement; // кнопка добавления или удаления товара из корзины

Реализует методы:
 - set description(value:string); // установка краткого описания товара
 - set ButtonText(value: string); // установка текста кнопки товара
 - set ButtonState(value: boolean); // установка состояния кнопки

  Конструктор принимает селектор, по которому в разметке страницы будет идентифицировано модальное окно и экземпляр класса EventEmitter для возможности инициации событий.

  #### Класс BasketProductView
Отвечает за установку значений свойств, необходимых для отображения товара в корзине

Расширяет класс BaseProductView

Реализует поля:
 - _button: HTMLButtonElement; // кнопка удаления товара из корзины
 - _index: HTMLElement; // контейнер порядкового номера товара в корзине

Реализует методы:
 - set index(value: number); // установка порядкового номера товара в корзине

  Конструктор принимает селектор, по которому в разметке страницы будет идентифицировано модальное окно и экземпляр класса EventEmitter для возможности инициации событий.

#### Класс Basket 
Отвечает за отображение модального окна корзины покупок, возвращая массив выбранных товаров, кнопки удаления товаров из корзины и показывает общую сумму заказа.

Поля:
- _list: HTMLElement; // контейнер списка товаров
- `_button: HTMLButtonElement; // кнопка оформления заказа
-  _total: HTMLElement; // контейнер общей суммы товаров в корзине

Методы:\
- set items(items: HTMLElement[]); // установка массива товаров
- set total(total: number); // установка общей стоимости

Конструктор принимает селектор, по которому в разметке страницы будет идентифицировано модальное окно и экземпляр класса EventEmitter для возможности инициации событий.

#### Класс OrderFormAddressView
Отвечает за информацию о способе оплаты и адресе пользователя. Класс используется для отображения модального окна на странице сайта.

Поля:
- _buttons: HTMLButtonElement[]; // Кнопки для выбора способа оплаты.
- _address: HTMLInputElement; // Поле для ввода адреса.

Методы:
- set payment(value: 'card' | 'cash'); // установка способа оплаты
- set address(value: string); // установка адреса
- clearAll(); // очистка полей

#### Класс OrderFormContactsView
Отвечает за информацию о пользователе. Класс используется для отображения модального окна на странице сайта.

Поля:
 - phoneNumber: HTMLInputElement; // поле ввода номера телефона
 - _email: HTMLInputElement; // поле ввода почты
 - phoneRegex; //Регулярное выражение для валидации номера телефона
 - emailRegex; //Регулярное выражение для валидации эл. почты

Методы:
- set phone(value: string); // установка номера телефона
- set email(value: string); // установка почты
- validateForm(); // валидация полей
- clearAll(); // очистка полей

#### Класс Form
Отвечает за валидацию полей формы. Класс используется для отображения модального окна на странице сайта.

Поля:
- set valid(value: boolean); // флаг валидности формы
- set errors(value: string); // ошибки в данных, введенных в форму
- get errors(); // получение значений полей ошибок
- updateForm(); // обновление полей
- render(state: Partial<T> & IFormState); // Рендер разметки формы
- onInputChange(field: keyof T, value: string) // Обновление валидности формы при вводе данных


#### Класс Successe
Отвечает за отображение модального окна с информацией о одобреннии заказа. Класс используется для отображения модального окна на странице сайта.

Поля:

- _content: HTMLElement; // элемент, содержащий все содержимое окна
- _close: HTMLButtonElement; // кнопка закрытия модального окна
- total: number; // общая сумма заказа

Методы:

- set total (value: number); // установка общей суммы заказа


### Слой коммуникации

#### Класс LarekAPI
Принимает в конструктор экземпляр класса Api и предоставляет методы реализующие взаимодействие с бэкендом сервиса.

## Взаимодействие компонентов
Код, описывающий взаимодействие представления и данных между собой находится в файле index.ts, выполняющем роль презентера.
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в index.ts
В index.ts сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

*Список всех событий, которые могут генерироваться в системе:*
*События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)*

1. События, связанные с модальными окнами:
- `modal:open` — открытие любого модального окна (например, корзины, карточки, оформления заказа).
- `modal:close` — закрытие модального окна.

2. События взаимодействия с карточками:
- `Products:loaded` — окончание загрузки списка товаров, вызывает рендер карточек на старницу.
- `Catalog:click` — клик по карточке товара в каталоге, вызывает запись preview.
- `product: selected` — выбор товара, вызывает открытие модального окна с товаром.

3. События, связанные с модальным окном, содержащем товар:
- `previewButton: click` - клик на кнопку в карточке товара, тобавляет или удаляет товар из корзины

4. События, связанные с корзиной:
- `Basket:open` — открытие корзины.
- `BasketModel:changed` — изменение данных, хранящихся в модели корзины.
- `ItemBasket:delete` — удаление товара из корзины.

5. События, связанные с формами оформления заказа:
- `Order:open` - открытие моадльного окна с адресом и способом оплаты товара
- `user:changed` - обновление информации о пользователе
- `contacts:open` - открытие модального окна с контактными данными пользователя(почта, телефон)
- `contacts:submit` - оформление покупки
- `Success:closed` - закрытие моадльного окна успешной покупки